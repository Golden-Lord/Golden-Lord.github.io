function game(){var a=document.getElementById("canvas"),b=a.getContext("2d");a.width=window.innerWidth,a.height=window.innerHeight;var c=30,d=1e3/c,e={width:5e3,height:3500,map:new Game.Map(5e3,3500)},f=0,g=0;e.map.generate();for(var h=new Game.Player(Game.random(1,e.width),Game.random(1,e.height),85,"orca"),i={x:0,y:0},j=[],k=0;k<20;k++)j.push(new Game.IceFloe(Game.random(1,e.width),Game.random(e.height/7,e.height),Game.random(150,225)));for(var l=[],k=0;k<j.length;k+=2)l.push(new Game.Seal(j[k]));var m=new Game.Minimap(e.width,e.height,a.width,a.height);m.generate(e.width,e.height,j,l);var n=function(){h.update(e.width,e.height,i.x,i.y,f,g),null!=h.wave&&(h.wave.update(),h.wave.dead&&(h.wave=null));for(var b=0;b<j.length;b++)Game.isColliding(j[b],h)?h.underIce=!0:h.underIce=!1;if(null!=h.wave)for(var b=0;b<l.length;b++)void 0!=l[b]&&Game.isColliding(h.wave,l[b])&&(l[b].x+=h.wave.velX,l[b].y+=h.wave.velY);for(var b=0;b<l.length;b++)void 0!=l[b]&&l[b].update(e.width,e.height,h);for(var b=0;b<l.length;b++)void 0!=l[b]&&(h.underwater||h.underIce||Game.isColliding(l[b],h)&&l.splice(b,1));i.x=h.x-a.width/2,i.y=h.y-a.height/2,m.update(e.width,e.height,h,l)},o=function(){b.clearRect(0,0,a.width,a.height),e.map.draw(b,i.x,i.y),h.draw(b,i.x,i.y),null!=h.wave&&h.wave.draw(b,i.x,i.y);for(var c=0;c<j.length;c++)j[c].draw(b,i.x,i.y);for(var c=0;c<l.length;c++)void 0!=l[c]&&l[c].draw(b,i.x,i.y);m.draw(b)},p=function(){n(),o()};setInterval(p,d);$(window).mousemove(function(a){f=a.pageX,g=a.pageY}),$(window).mousedown(function(a){1==a.which&&(h.boostOn=!0),3==a.which&&(h.onLand||(h.underwater=!0,h.ability()))}),$(window).mouseup(function(a){1==a.which&&(h.boostOn=!1),3==a.which&&(h.underwater=!1)}),$(window).contextmenu(function(a){a.preventDefault()})}window.Game={},function(){function a(a,b){return Math.floor(Math.random()*(b-a+1)+a)}Game.random=a}(),function(){function a(a,b,c){return Math.abs(a-b)<c}Game.approxEq=a}(),function(){function a(a,b){var c=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y));if(c<=a.r+b.r)return!0}Game.isColliding=a}(),function(){function a(a,b,c,d,e){this.x=a-c*-Math.sin(d),this.y=b-c*Math.cos(d),this.r=c,this.velX=0,this.velY=0,this.speed=3*e,this.angle=d,this.dead=!1;var f=this;setTimeout(function(){f.dead=!0},1e3)}a.prototype.update=function(){this.velX=this.speed*-Math.sin(this.angle),this.velY=this.speed*Math.cos(this.angle),this.x+=this.velX,this.y+=this.velY},a.prototype.draw=function(a,b,c){var d=this.x-b,e=this.y-c;a.save(),a.beginPath(),a.ellipse(d,e,this.r,this.r,this.angle-Math.PI/4,.5*Math.PI,1*Math.PI),a.strokeStyle="#0099ff",a.lineWidth=this.r/6,a.stroke(),a.beginPath(),a.ellipse(d,e,this.r,this.r,this.angle-Math.PI/4,.5*Math.PI,1*Math.PI),a.strokeStyle="#4db8ff",a.lineWidth=this.r/18,a.stroke(),a.restore()},Game.Wave=a}(),function(){function a(a,b,c,d){this.x=a,this.y=b,this.maxSpeed=5,this.speed=5,this.velX=0,this.velY=0,this.r=c,this.angle=0,this.animal=d,this.wave=null,this.image=new Image,"orca"==this.animal&&(this.image.src="http://mope.io/skins/killerwhale.png"),this.underwater=!1,this.underIce=!1,this.onLand=!1,this.boostEnabled=!0,this.boostOn=!1,this.canUseAbility=!0}a.prototype.update=function(a,b,c,d,e,f){this.underwater?this.image.src="http://mope.io/img/ability_dive.png":"orca"==this.animal&&(this.image.src="http://mope.io/skins/killerwhale.png"),this.speed>this.maxSpeed&&this.speed--,this.speed<this.maxSpeed&&this.speed++,this.boostOn&&this.boost(),this.y-this.r<b/7?this.onLand=!0:this.onLand=!1,this.onLand?this.maxSpeed=3:this.maxSpeed=5,this.angle=Math.atan2(-(e-(this.x-c)),f-(this.y-d)),this.velX=this.speed*-Math.sin(this.angle),this.velY=this.speed*Math.cos(this.angle),this.x+=this.velX,this.y+=this.velY,this.x-this.r<0&&(this.x=this.r),this.y-this.r<0&&(this.y=this.r),this.x+this.r>a&&(this.x=a-this.r),this.y+this.r>b&&(this.y=b-this.r)},a.prototype.ability=function(){if(this.canUseAbility&&"orca"==this.animal){this.wave=new Game.Wave(this.x,this.y,3*this.r,this.angle,this.speed),this.speed+=20,this.canUseAbility=!1;var a=this;setTimeout(function(){a.canUseAbility=!0},100)}},a.prototype.boost=function(){if(this.boostEnabled){this.speed+=10,this.boostEnabled=!1;var a=this;setTimeout(function(){a.boostEnabled=!0},1e3)}},a.prototype.draw=function(a,b,c){var d=this.x-b,e=this.y-c;a.save(),a.translate(d,e),a.rotate(this.angle),a.drawImage(this.image,0-this.r,0-this.r,2*this.r,2*this.r),a.restore()},Game.Player=a}(),function(){function a(a){this.home=a,this.x=a.x,this.y=a.y,this.r=60,this.angle=0,this.velX=0,this.velY=0,this.speed=4,this.onIce=!0,this.comingHome=!1,this.range={x:0,y:0,r:500},this.image=new Image,this.image.src="http://mope.io/skins/arctic/seal.png"}a.prototype.update=function(a,b,c){this.range.x=this.x,this.range.y=this.y,this.comingHome&&Game.approxEq(this.x,this.home.x,10)&&Game.approxEq(this.y,this.home.y,10)&&(this.comingHome=!1),Game.isColliding(this.home,this)?this.onIce=!0:this.onIce=!1,this.onIce?this.comingHome||this.patrol():Game.isColliding(this.range,c)?this.run(c):this.goBack(),this.velX=this.speed*-Math.sin(this.angle),this.velY=this.speed*Math.cos(this.angle),this.x+=this.velX,this.y+=this.velY,this.x-this.r<0&&(this.x=this.r),this.y-this.r<0&&(this.y=this.r),this.x+this.r>a&&(this.x=a-this.r),this.y+this.r>b&&(this.y=b-this.r)},a.prototype.patrol=function(){this.angle+=Math.PI/30},a.prototype.goBack=function(){this.angle=Math.atan2(-(this.home.x-this.x),this.home.y-this.y),this.comingHome=!0},a.prototype.run=function(a){this.angle=Math.atan2(a.x-this.x,-(a.y-this.y))},a.prototype.draw=function(a,b,c){var d=this.x-b,e=this.y-c;a.save(),a.translate(d,e),a.rotate(this.angle),a.drawImage(this.image,0-this.r,0-this.r,2*this.r,2*this.r),a.restore()},Game.Seal=a}(),function(){function a(a,b,c,d){this.width=c/5,this.height=c/5*(b/a),this.x=c-1.1*this.width,this.y=.1*this.height,this.playerX=0,this.playerY=0,this.arcticW=this.width,this.arcticH=this.height/7,this.iceFloes=[],this.seals=[]}a.prototype.generate=function(a,b,c,d){for(var e=0;e<c.length;e++)this.iceFloes.push({x:0,y:0,r:0});for(var e=0;e<this.iceFloes.length;e++)this.iceFloes[e].x=this.x+c[e].x/(a/this.width),this.iceFloes[e].y=this.y+c[e].y/(b/this.height),this.iceFloes[e].r=c[e].r/50;for(var e=0;e<d.length;e++)this.seals.push({x:0,y:0,r:0});for(var e=0;e<this.seals.length;e++)this.seals[e].x=this.x+d[e].x/(a/this.width),this.seals[e].y=this.y+d[e].y/(b/this.height),this.seals[e].r=d[e].r/25},a.prototype.update=function(a,b,c,d){this.playerX=this.x+c.x/(a/this.width),this.playerY=this.y+c.y/(b/this.height);for(var e=0;e<this.seals.length;e++)void 0!=this.seals[e]&&void 0!=d[e]&&(this.seals[e].x=this.x+d[e].x/(a/this.width),this.seals[e].y=this.y+d[e].y/(b/this.height))},a.prototype.draw=function(a){a.save(),a.fillStyle="rgba(255, 255, 255, 0.7)",a.fillRect(this.x,this.y,this.arcticW,this.arcticH),a.fillStyle="rgba(0, 102, 255, 0.7)",a.fillRect(this.x,this.y+this.arcticH,this.width,this.height-this.arcticH),a.beginPath(),a.arc(this.playerX,this.playerY,3,0,2*Math.PI),a.fillStyle="rgba(0, 255, 0, 0.7)",a.fill();for(var b=0;b<this.iceFloes.length;b++)a.beginPath(),a.arc(this.iceFloes[b].x,this.iceFloes[b].y,this.iceFloes[b].r,0,2*Math.PI),a.fillStyle="rgba(255, 255, 255, 0.7)",a.fill();for(var b=0;b<this.seals.length;b++)void 0!=this.seals[b]&&(a.beginPath(),a.arc(this.seals[b].x,this.seals[b].y,this.seals[b].r,0,2*Math.PI),a.fillStyle="rgba(255, 0, 0, 0.7)",a.fill())},Game.Minimap=a}(),function(){function a(a,b,c){this.x=a,this.y=b,this.r=c}a.prototype.draw=function(a,b,c){a.save(),a.beginPath(),a.arc(this.x-b,this.y-c,this.r,0,2*Math.PI),a.fillStyle="#f5f5fa",a.fill(),a.restore()},Game.IceFloe=a}(),function(){function a(a,b){this.width=a,this.height=b,this.image=null}a.prototype.generate=function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=this.width,a.height=this.height;var c=this.width,d=this.height;b.save(),b.fillStyle="#1aa3ff",b.fillRect(0,0,this.width,this.height),b.fillStyle="#f5f5fa",b.fillRect(0,0,c,d/7),this.image=new Image,this.image.src=a.toDataURL("image/png"),b=null},a.prototype.draw=function(a,b,c){var d,e,f,g,h,i,j,k;d=b,e=c,h=a.canvas.width,i=a.canvas.height,this.image.width-d<h&&(h=this.image.width-d),this.image.height-e<i&&(i=this.image.height-e),f=0,g=0,j=h,k=i,a.drawImage(this.image,d,e,h,i,f,g,j,k)},Game.Map=a}(),window.onload=function(){game()};
